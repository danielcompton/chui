#!/usr/bin/env bb

(ns proj
  (:require [clojure.java.shell :as sh]
            [lioss.main :as lioss]
            [lioss.shellutil :as shellutil]))

(defn gen-styles [opts]
  (println "Generating  modules/chui-ui/release/lambdaisland/chui/styles.clj")
  (shellutil/mkdir-p "modules/chui-ui/release/lambdaisland/chui/")
  (spit "modules/chui-ui/release/lambdaisland/chui/styles.clj"
        (str "(ns lambdaisland.chui.styles)\n"
             ";; Auto-generated by bin/proj\n"
             "(defmacro inline []\n"
             (:out (sh/sh "clojure" "-A:dev" "-e" "(require 'lambdaisland.chui.styles) (prn (lambdaisland.chui.styles/inline))"))
             ")"))
  opts)

(lioss/main
 {:license        :epl
  :inception-year 2020
  :description    "Modern ClojureScript test runner"
  :pre-release-hook gen-styles
  :modules [{:name        "chui-core"
             :description "ClojureScript Test Runner Core"}
            {:name        "chui-ui"
             :description "Browser UI for the Chui test runner"}
            {:name        "chui-remote"
             :description "Funnel client for connecting test tooling to ClojureScript runtimes"}
            {:name        "chui-shadow"
             :description "Chui-based test runner namespaces to be used with Shadow-cljs"}]
  :commands ["styles"
             {:description "Generate inlined CSS from Garden"
              :command gen-styles}]
  })

;; Local Variables:
;; mode:clojure
;; End:
